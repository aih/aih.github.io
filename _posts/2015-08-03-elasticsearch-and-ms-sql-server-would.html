---
layout: post
title: 'Elasticsearch and MS SQL Server: Would you like search with that?'
date: '2015-08-03T17:42:00.004-07:00'
author: Ari Hershowitz
tags:
- search
- Elasticsearch
- U.S. Code
- lucene
- Open Government
- SQL Server
modified_time: '2021-07-10T13:06:09.779-07:00'
blogger_id: tag:blogger.com,1999:blog-7029518648320057552.post-276409269405876672
blogger_orig_url: https://blog.linkedlegislation.com/2015/08/elasticsearch-and-ms-sql-server-would.html
---

<span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; line-height: 25.6px;">In our data-rich world, everything goes better with search. We've gotten used to having search as a baked-in feature of applications and expect the search to be full-featured and flexible. So when building a data-rich enterprise web application, the question is often not whether to include search, but how.</span><br /><div style="box-sizing: border-box; margin-bottom: 16px;"><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;">If the data is stored on MS SQL Server, which is usually the case with the government customers we work with at Xcential, one option is the full-text search for MS SQL Server. However, full-text search is a relatively recent addition to SQL Server. Its feature set is limited and in my opinion its query language, an extension of SQL, gets over-complicated quite quickly.</span></span><br /><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;">There are also a number of open source search engines (Elasticsearch &nbsp;and Solr, based on Apache Lucene, Sphinx) which are fast, robust and used in many of the search functions we are used to on websites such as Twitter, Facebook and Craigslist. The widespread use of these search engines also means that people are familiar with their features and they meet users' general expectations of how search should work. As with any open source project primarily developed in Linux environments, it is important to ask how well do these projects play with Windows?</span></span><br /><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;">In particular, how can the data from SQL Server be indexed and queried? My recent experience with Elasticsearch shows that, with some caveats, this can now be done rather painlessly.</span></span><br /><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><b>Import SQL Server Data to Elasticsearch</b></span></span></div><div style="box-sizing: border-box; margin-bottom: 16px;"><span style="color: #333333;"><i>[July 2021 Update: Logstash now provides a <a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html">JDBC plugin for SQL</a>, which is what we use for our latest generation application to ingest SQL data to Elasticsearch]</i><br /></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;">If you search Google for 'SQL Server and Elasticsearch', there are many outdated references for how to create an index. Elasticsearch has deprecated the previous tools for importing SQL data, from what they used to call 'rivers'. But do not despair. <a href="https://github.com/jprante">JÃ¶rg Prante</a> has built an excellent open-source JDBC importer to support a variety of SQL databases, including SQL server. The instructions for using the tool are clear and straightforward, but as Prante writes, Windows user have had lots of problems using it. There are some tricks.</span></span><br /><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;">The general instructions for using the jdbc importer are&nbsp;</span></span><a href="https://github.com/jprante/elasticsearch-jdbc#ms-sql-server" style="box-sizing: border-box; color: #4078c0; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; text-decoration: none;">here</a><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;">. But it doesn't quite work. <b>Steps 1 and 2</b>&nbsp;are to download and install&nbsp;elasticsearch. That actually goes quite smoothly. You will need <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/setup.html#jvm-version">Java (&gt;1.8 update 20 or &gt;1.7 update 55) installed on your system</a>, but if I recall, the elasticsearch.bat script will walk you through installing that, if you don't have it already. Once elasticsearch is installed, I would recommend also <a href="https://www.elastic.co/guide/en/marvel/current/_installation.html">installing the Marvel plugin</a> (free developer trial) and starting the&nbsp;</span></span><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/sense_widget.html?snippets/030_Data/45_Upsert.json" style="box-sizing: border-box; color: #4078c0; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; text-decoration: none;">Sense interface</a>. <span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;">This will make it much easier to monitor the indexes you create and to test queries in elasticsearch.</span></span><br /><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><b>Step 3</b> is to install the jdbc importer, using the command line <i>wget</i> application. While you could install <a href="https://superuser.com/questions/77247/how-do-i-install-wget-for-windows/813046#813046">wget by itself</a>, you'll need the bash terminal from Cygwin for a later step, so might as well <a href="https://cygwin.com/install.html">install Cygwin now</a>. From the new Cygwin bash terminal, you can use wget to install the jdbc importer.</span></span><br /><span face="Helvetica Neue, Helvetica, Segoe UI, Arial, freesans, sans-serif" style="color: #333333;"><span style="line-height: 25.6px;"><br /></span></span><span style="background-color: rgba(0, 0, 0, 0.04); color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; line-height: 21.76px;">wget https://xbib.org/repository/org/xbib/elasticsearch/importer/elasticsearch-jdbc/&lt;version&gt;/elasticsearch-jdbc-&lt;version&gt;-dist.zip</span><br /><span style="background-color: rgba(0, 0, 0, 0.04); color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; line-height: 21.76px;"><br /></span><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;">Also in cygwin, move the zip file into your <i>\Program Files (x86)</i>&nbsp;directory and unzip using the unzip utility from Cygwin. (This may require administrative privileges.)</span><br /><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;"><br /></span><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;">In </span><b style="color: #333333; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px;">steps 4 and 5</b><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;">, you download the jdbc driver from Microsoft and put it into the /</span><i style="color: #333333; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px;">lib</i><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;">&nbsp;folder of the JDBC driver package. &nbsp;</span><br /><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;"><br /></span><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;">At <b>step 6</b> (set up database,&nbsp;</span><a href="https://stackoverflow.com/questions/2388042/connect-to-sql-server-2008-with-tcp-ip" style="box-sizing: border-box; color: #4078c0; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; text-decoration: none;">make sure to allow TCP/IP connections</a><span face="'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif" style="color: #333333; font-size: 16px; line-height: 25.6px;">), there are a number of nuances:</span></div><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; max-width: initial; overflow-wrap: normal; overflow: initial; padding: 0px; word-break: normal; word-wrap: normal;">1. Enable TCP/IP in the SQL SERVER CONFIGURATION MANAGER ( (Start Menu &gt; Microsoft SQL Server &gt; Configuration Tools &gt; SQL Server Configuration Manager &gt; SQL Server Network Configuration)<br />2. Start the SQL SERVER BROWSER Service. To do this, open the CONFIGURATION MANAGER as an administrator (right click to open). Once in the Manager, right click the BROWSER SERVICE, click Properties and change the Start Mode to Enabled. (https://stackoverflow.com/a/21378235)<br />3. Explicitly set the TCP to 1433, as explained in these [two](https://stackoverflow.com/a/18850073) [answers](https://stackoverflow.com/a/24299346).<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">Also,<span style="line-height: 25.6px;">&nbsp;</span><a href="https://msdn.microsoft.com/en-us/library/ms188670.aspx" style="box-sizing: border-box; color: #4078c0; line-height: 25.6px; text-decoration: none;">change the database server authentication to 'Mixed Mode'</a><span style="line-height: 25.6px;">. Give permissions on the database to a user and set the password for that user.&nbsp;</span><br /><span style="line-height: 25.6px;"><br /></span><b>Step 7</b> is to start the elasticsearch engine. Easy enough.<br /><br /><b>Step 8</b> has a sample script to import data into elasticsearch.<br /><br />For windows, the variables in path names need to be in quotes and do not have braces. So I changed these lines in the script:</div><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; max-width: initial; overflow-wrap: normal; overflow: initial; padding: 0px; word-break: normal; word-wrap: normal;">-cp "${lib}/*" \<br />-Dlog4j.configurationFile=${bin}/log4j2.xml \<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">to</div><pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; max-width: initial; overflow-wrap: normal; overflow: initial; padding: 0px; word-break: normal; word-wrap: normal;">-cp "$lib/*" \<br />-Dlog4j.configurationFile="$bin"/log4j2.xml \&nbsp;</code></pre><div style="box-sizing: border-box; color: #333333; font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px;"><span style="line-height: 25.6px;">In order to run the script, I found it most convenient to copy and paste the text directly into the Cygwin terminal. Note, that to paste text into a Cygwin terminal, you can right click and chose 'paste', or type 'shift-Insert'.</span><br /><br />I copied and pasted (shift-Insert) the script into the bash terminal.<br /><br />I have updated the instructions for <a href="https://gist.github.com/aih/f0370479669e3003b2a4">using the jdbc importer with MS SQL Server in this gist</a>. Next, I'll discuss how to build a general purpose user interface for the Elasticsearch engine.</div>