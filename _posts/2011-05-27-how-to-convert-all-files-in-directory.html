---
layout: post
title: 'How to Convert All Files in a Directory: CA Legislation'
date: '2011-05-27T09:39:00.000-07:00'
author: Ari Hershowitz
tags:
- Metadata
- legal technology
- Open Government
- Open States
- state law
- technical post
- California Legislation
- text conversion
- Find Utility
- legislation
modified_time: '2011-11-15T10:32:22.644-08:00'
thumbnail: https://lh3.ggpht.com/-wtkhuqt7M_8/Td_T2kQFZTI/AAAAAAAADsQ/BL5w_bYQcmc/s72-c/CALegislation_Before-thumb.png
blogger_id: tag:blogger.com,1999:blog-7029518648320057552.post-4265135983596184642
blogger_orig_url: https://blog.linkedlegislation.com/2011/05/how-to-convert-all-files-in-directory.html
---

<div style="clear: both;">Starting with the <a href="https://blog.tabulaw.com/2011/05/california-law-recovering-meaning-and.html" target="_blank" title="previous blog post">unstructured data in California's legislation</a>, it <a href="https://blog.tabulaw.com/2011/05/california-laws-converting-plain-text.html" target="_blank" title="Step 1">takes</a> <a href="https://blog.tabulaw.com/2011/05/how-to-convert-text-to-html-using.html" target="_blank" title="Step 2">many</a> <a href="https://blog.tabulaw.com/2011/05/how-to-convert-citations-to-hyperlinks.html" target="_blank" title="Steps 3 and 4">steps</a> to add structure to a single Section. Or rather, to add back in the metadata that the Section's original drafters intended, to help a reader understand and navigate the law. The next step is to apply the transformations to all of the Sections in the law.</div><div class="separator" style="clear: both; text-align: center;"><a class="image-link" href="https://lh4.ggpht.com/-pvnB_TtWqwI/Td_TrkV-KBI/AAAAAAAADsA/X9trH_jCbYE/s800/CALegislation_Before-full.png"><img align="left" class="linked-to-original" height="187" src="https://lh3.ggpht.com/-wtkhuqt7M_8/Td_T2kQFZTI/AAAAAAAADsQ/BL5w_bYQcmc/s800/CALegislation_Before-thumb.png" style="display: inline; float: left; margin-bottom: 10px; margin-left: 0px; margin-right: 10px; margin-top: 0px;" width="378" /></a></div><div>California helpfully makes all of its codes <a href="https://www.leginfo.ca.gov/FTProtocol.html" target="_blank" title="CA website for ftp">available for FTP download</a> in a set of nested folders. It would be great if more government agencies made their data available in bulk. But we still have a problem: How to recursively iterate through all the files and folders in the directory (29 folders, 50,000 <strike>files </strike>&nbsp;sections in total) and apply the parsing transformations to each file. Each file consists of a (variable) number of sections, e.g. <a href="https://www.leginfo.ca.gov/cgi-bin/displaycode?section=veh&amp;group=12001-13000&amp;file=12500-12527" target="_blank" title="Sample CA law Sectin">here</a>.</div><div><br />For this task, I went back to another old Linux utility: Find. If you type "Find /" from a command prompt in Linux (also MacOS), you get a list of all of the files and folders on your computer. Don't do this. It will take a long time, and is not really useful for anything. But you can use this powerful command within a single directory, and send the list of file names to a program that will operate on each one. In this case, I wrapped this all in a Python program, using the POpen() function to run any Linux commands that I wanted. Gory details below the fold.<br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a class="image-link" href="https://lh5.ggpht.com/-_gcg3_cZwcU/Td_Tsl0TtgI/AAAAAAAADsM/S3n0FHCu4OE/s800/CALegislation_After-full.png" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img align="left" class="linked-to-original" height="183" src="https://lh5.ggpht.com/-6ihjprORY28/Td_T3vlPSgI/AAAAAAAADsY/HK-DjZu7VKU/s800/CALegislation_After-thumb.png" style="display: inline; float: left; margin-bottom: 10px; margin-left: 0px; margin-right: 10px; margin-top: 0px;" width="88" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">CA Codes After</td></tr></tbody></table><br />If you want to skip the details and go straight to the results, I've put the newly transformed California code sections on a website (<a href="https://calaw.tabulaw.com/" target="_blank" title="California Legislation">calaw.tabulaw.com</a>). Currently, the design is very simple and has no styling, whatsoever. But I welcome you to do a before and after comparison and let me know what you think in the comments.</div><div></div><div><br />In my view, converting CA Legislation to structured data makes navigating the code much easier. It also reveals some problems with the version on California's website-- repeated sections, stray text markings--that should probably be cleaned up. More about these anomalies, and the brave new world that structured data can bring to law, in future posts.</div><div style="clear: both;"></div><a name='more'></a>This is a simplified snippet of the script I used. The first line defines a command to run through all of the files in a directory and 'print' them to use in the next set of commands. Then I iterate over all of the files in this list, first <a href="https://blog.tabulaw.com/2011/05/how-to-convert-text-to-html-using.html" target="_blank" title="previous post txttohtml">converting the file to html</a>, then running a set of functions to find all of the <a href="https://blog.tabulaw.com/2011/05/how-to-convert-sections-into-hyperlink.html" target="_blank" title="previous post on Linux sed">section and subdivision titles</a>, and then to <a href="https://blog.tabulaw.com/2011/05/how-to-convert-citations-to-hyperlinks.html" target="_blank" title="previous post: adding hyperlinks">add links to references within the text</a>&nbsp;(not shown below).<br /> <pre><br />import os<br />from subprocess import Popen<br />cmd = "find <em>path/to/file</em> -print"<br />fileslist = Popen(cmd, shell=True, stdout=PIPE)<br />for file in fileslist.stdout.readlines():<br />    if os.path.isfile(file):<br />        print "THE FILE IS:"+file<br />        # Runs Linux commands and channels output to the PIPE output<br />        parsedfile = Popen("txt2html --explicit_headings --indent_par_break --make_tables --make_anchors --xhtml " + file + "| ssed -R -n -f File_to_Parse_Sections", bufsize=-1, stdout=PIPE, shell=True)<br />...<br /></pre><br class="final-break" style="clear: both;" />